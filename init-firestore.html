<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Initialize Firestore Database</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
      background: #0b0f1a;
      color: #e7ecf6;
    }
    .container {
      background: #111827;
      border: 1px solid #1f2937;
      border-radius: 12px;
      padding: 2rem;
    }
    .login-container {
      max-width: 400px;
      margin: 2rem auto;
    }
    input[type="password"] {
      width: 100%;
      background: #0a1122;
      color: #e7ecf6;
      border: 1px solid #1f2937;
      padding: 0.75rem;
      border-radius: 8px;
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    input[type="password"]:focus {
      outline: none;
      border-color: #ff9d00;
      box-shadow: 0 0 0 3px rgba(255, 157, 0, 0.35);
    }
    .error-msg {
      color: #ef4444;
      margin-top: 0.5rem;
      display: none;
    }
    #mainContent {
      display: none;
    }
    h1 {
      color: #ff9d00;
      margin-top: 0;
    }
    button {
      background: #ff9d00;
      color: #0b0f1a;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 700;
      cursor: pointer;
      font-size: 1rem;
      margin: 0.5rem 0.5rem 0.5rem 0;
    }
    button:hover {
      opacity: 0.9;
    }
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .success {
      background: #22c55e;
      color: white;
    }
    .warning {
      background: #f59e0b;
    }
    #log {
      background: #0a1122;
      border: 1px solid #1f2937;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1rem;
      max-height: 400px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.9rem;
    }
    .log-entry {
      margin: 0.25rem 0;
    }
    .log-success { color: #22c55e; }
    .log-error { color: #ef4444; }
    .log-info { color: #60a5fa; }
    .log-warning { color: #f59e0b; }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen" class="container login-container">
    <h1>üîê Admin Access Required</h1>
    <p>Enter your admin credentials to access Firestore initialization tools.</p>
    <input type="email" id="adminEmail" placeholder="Enter admin email" />
    <input type="password" id="adminPassword" placeholder="Enter password" />
    <button onclick="verifyPassword()">Login</button>
    <div id="errorMsg" class="error-msg">Incorrect credentials</div>
  </div>

  <!-- Main Content (hidden until authenticated) -->
  <div id="mainContent" class="container">
    <h1>üî• Initialize Firestore Database</h1>
    <p>This tool will populate your Firestore database with initial team and bracket data.</p>

    <div>
      <button id="initTeamsBtn" onclick="initializeTeams()">Initialize Teams</button>
      <button id="initBracketBtn" onclick="initializeBracket()">Initialize Bracket</button>
      <button id="initPasswordBtn" onclick="initializeAdminPassword()">Set Admin Password</button>
      <button id="initInitPasswordBtn" onclick="initializeInitPassword()">Set Init Password</button>
      <button class="success" onclick="initializeAll()">Initialize All Data</button>
      <button class="warning" onclick="clearLog()">Clear Log</button>
    </div>

    <div id="log"></div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, doc, setDoc, getDocs, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    import { getAuth, signInWithEmailAndPassword, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyBN0rfpzjredziJbPny-YfEgq4uE2l1hzE",
      authDomain: "iba-website-63cb3.firebaseapp.com",
      projectId: "iba-website-63cb3",
      storageBucket: "iba-website-63cb3.firebasestorage.app",
      messagingSenderId: "267064036667",
      appId: "1:267064036667:web:4f9d28aac0d5ae4ca97b1e",
      measurementId: "G-GGH99DCY07"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    // Admin UID
    const ADMIN_UID = 'seZ01FolJbSajEKTIsljwGtYHGD3';

    // Make available globally
    window.db = db;
    window.auth = auth;
    window.ADMIN_UID = ADMIN_UID;
    window.firestoreImports = { collection, doc, setDoc, getDocs, getDoc };
    window.authImports = { signInWithEmailAndPassword, signOut };

    // Firebase Auth verification
    window.verifyPassword = async function() {
      const email = document.getElementById('adminEmail').value.trim();
      const password = document.getElementById('adminPassword').value;
      const errorMsg = document.getElementById('errorMsg');
      const loginBtn = document.querySelector('#loginScreen button');

      if (!email || !password) {
        errorMsg.textContent = 'Please enter both email and password';
        errorMsg.style.display = 'block';
        return;
      }

      loginBtn.disabled = true;
      loginBtn.textContent = 'Verifying...';

      try {
        const { signInWithEmailAndPassword } = window.authImports;
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // Check if the logged-in user is the admin
        if (user.uid !== ADMIN_UID) {
          errorMsg.textContent = 'You do not have admin privileges';
          errorMsg.style.display = 'block';
          await auth.signOut(); // Sign them out
          loginBtn.disabled = false;
          loginBtn.textContent = 'Login';
          return;
        }

        // Success - show main content
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        errorMsg.style.display = 'none';
      } catch (error) {
        console.error('Error verifying credentials:', error);
        if (error.code === 'auth/invalid-credential' || error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
          errorMsg.textContent = 'Incorrect email or password';
        } else {
          errorMsg.textContent = 'Error logging in. Check console for details.';
        }
        errorMsg.style.display = 'block';
        document.getElementById('adminPassword').value = '';
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = 'Login';
      }
    };

    // Allow Enter key to submit
    document.getElementById('adminPassword')?.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        verifyPassword();
      }
    });

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(message);
    }

    window.clearLog = function() {
      document.getElementById('log').innerHTML = '';
    };

    window.initializeTeams = async function() {
      const btn = document.getElementById('initTeamsBtn');
      btn.disabled = true;
      log('Starting teams initialization...', 'info');

      const teamsData = {
        'mutts': {
          name: 'Mutts and Fulls',
          seed: 1,
          icon: 'üèÄ',
          record: { wins: 3, losses: 0 },
          pointDiff: 42,
          roster: [],
          completedGames: [
            { opponent: 'Buckit', result: 'W', score: '21-8', date: 'Sep 22' },
            { opponent: 'Certified Bucket Getters', result: 'W', score: '19-0', date: 'Sep 29' },
            { opponent: 'The Blue Ballers', result: 'W', score: '22-12', date: 'Oct 1' }
          ],
          upcomingGames: []
        },
        'bbb': {
          name: 'BBB',
          seed: 2,
          icon: 'üî•',
          record: { wins: 3, losses: 0 },
          pointDiff: 38,
          roster: [],
          completedGames: [
            { opponent: 'ARE 3.0', result: 'W', score: '21-18', date: 'Sep 22' },
            { opponent: 'Lafayette Lakers', result: 'W', score: '21-2', date: 'Oct 1' },
            { opponent: 'Rasthuggers', result: 'W', score: '21-5', date: 'Oct 2' }
          ],
          upcomingGames: []
        },
        'rajesh': {
          name: "Rajesh's Last Dance",
          seed: 3,
          icon: 'üõ°Ô∏è',
          record: { wins: 3, losses: 0 },
          pointDiff: 27,
          roster: [],
          completedGames: [
            { opponent: 'Buzz Ballers', result: 'W', score: '9-0', date: 'Sep 25' },
            { opponent: 'SAP Center', result: 'W', score: '21-14', date: 'Sep 30' },
            { opponent: 'LeBronda', result: 'W', score: '11-0', date: 'Oct 2' }
          ],
          upcomingGames: []
        },
        'club': {
          name: 'Club ballers',
          seed: 4,
          icon: '‚ö°',
          record: { wins: 3, losses: 0 },
          pointDiff: 20,
          roster: [],
          completedGames: [
            { opponent: 'Ja Wick', result: 'W', score: '22-11', date: 'Sep 22' },
            { opponent: 'RRN', result: 'W', score: '21-16', date: 'Sep 24' },
            { opponent: 'gutti boys', result: 'W', score: '21-17', date: 'Sep 30' }
          ],
          upcomingGames: []
        },
        'navsandeep': {
          name: 'Nav/Sandeep',
          seed: 5,
          icon: '‚≠ê',
          record: { wins: 3, losses: 0 },
          pointDiff: 18,
          roster: [],
          completedGames: [
            { opponent: 'Diko & Co.', result: 'W', score: '22-18', date: 'Sep 22' },
            { opponent: 'Kareem Puffs', result: 'W', score: '21-14', date: 'Sep 29' },
            { opponent: 'Tech Support', result: 'W', score: '21-14', date: 'Oct 2' }
          ],
          upcomingGames: []
        },
        'kos': {
          name: 'KOS',
          seed: 6,
          icon: 'üëë',
          record: { wins: 3, losses: 0 },
          pointDiff: 17,
          roster: [],
          completedGames: [
            { opponent: 'Swish Kebabs', result: 'W', score: '21-18', date: 'Sep 25' },
            { opponent: 'Tandoori Towers', result: 'W', score: '21-11', date: 'Sep 29' },
            { opponent: '67 Elite Freaks', result: 'W', score: '21-17', date: 'Sep 30' }
          ],
          upcomingGames: []
        },
        'lemickey': {
          name: 'LeMickey',
          seed: 7,
          icon: 'üèÜ',
          record: { wins: 3, losses: 0 },
          pointDiff: 13,
          roster: [],
          completedGames: [
            { opponent: 'Squirt Sisters', result: 'W', score: '21-18', date: 'Sep 25' },
            { opponent: 'Fuse', result: 'W', score: '21-13', date: 'Sep 30' },
            { opponent: 'Hoop', result: 'W', score: '21-19', date: 'Oct 1' }
          ],
          upcomingGames: []
        },
        'bbs': {
          name: 'BBS',
          seed: 8,
          icon: 'üí™',
          record: { wins: 3, losses: 0 },
          pointDiff: 11,
          roster: [],
          completedGames: [
            { opponent: 'Walmart Oreos', result: 'W', score: '21-15', date: 'Sep 22' },
            { opponent: 'The Baboons', result: 'W', score: '21-19', date: 'Sep 29' },
            { opponent: 'Naujawan', result: 'W', score: '21-18', date: 'Oct 1' }
          ],
          upcomingGames: []
        },
        'gutti': {
          name: 'gutti boys',
          seed: 9,
          icon: 'üåü',
          record: { wins: 2, losses: 1 },
          pointDiff: 20,
          roster: [],
          completedGames: [
            { opponent: 'Ja Wick', result: 'W', score: '21-7', date: 'Sep 25' },
            { opponent: 'Club ballers', result: 'L', score: '17-21', date: 'Sep 30' },
            { opponent: 'RRN', result: 'W', score: '21-11', date: 'Oct 2' }
          ],
          upcomingGames: []
        },
        'sap': {
          name: 'SAP Center',
          seed: 10,
          icon: 'üèüÔ∏è',
          record: { wins: 2, losses: 1 },
          pointDiff: 15,
          roster: [],
          completedGames: [
            { opponent: 'LeBronda', result: 'W', score: '11-0', date: 'Sep 25' },
            { opponent: "Rajesh's Last Dance", result: 'L', score: '14-21', date: 'Sep 30' },
            { opponent: 'Buzz Ballers', result: 'W', score: '11-0', date: 'Oct 1' }
          ],
          upcomingGames: []
        },
        'are': {
          name: 'ARE 3.0',
          seed: 11,
          icon: 'üöÄ',
          record: { wins: 2, losses: 1 },
          pointDiff: 12,
          roster: [],
          completedGames: [
            { opponent: 'BBB', result: 'L', score: '18-21', date: 'Sep 22' },
            { opponent: 'Lafayette Lakers', result: 'W', score: '21-16', date: 'Sep 29' },
            { opponent: 'Rasthuggers', result: 'W', score: '21-11', date: 'Sep 30' }
          ],
          upcomingGames: []
        },
        'naujawan': {
          name: 'Naujawan',
          seed: 12,
          icon: 'üíé',
          record: { wins: 2, losses: 1 },
          pointDiff: 11,
          roster: [],
          completedGames: [
            { opponent: 'The Baboons', result: 'W', score: '21-17', date: 'Sep 22' },
            { opponent: 'Walmart Oreos', result: 'W', score: '22-12', date: 'Sep 29' },
            { opponent: 'BBS', result: 'L', score: '18-21', date: 'Oct 1' }
          ],
          upcomingGames: []
        },
        'buckit': {
          name: 'Buckit',
          seed: 13,
          icon: 'ü™£',
          record: { wins: 2, losses: 1 },
          pointDiff: 10,
          roster: [],
          completedGames: [
            { opponent: 'Mutts and Fulls', result: 'L', score: '8-21', date: 'Sep 22' },
            { opponent: 'Certified Bucket Getters', result: 'W', score: '22-4', date: 'Sep 25' },
            { opponent: 'The Blue Ballers', result: 'W', score: '21-16', date: 'Oct 2' }
          ],
          upcomingGames: []
        },
        'swish': {
          name: 'Swish Kebabs',
          seed: 14,
          icon: 'üå∂Ô∏è',
          record: { wins: 1, losses: 2 },
          pointDiff: 18,
          roster: [],
          completedGames: [
            { opponent: 'KOS', result: 'L', score: '18-21', date: 'Sep 25' },
            { opponent: 'Tandoori Towers', result: 'L', score: '17-21', date: 'Sep 30' },
            { opponent: '67 Elite Freaks', result: 'W', score: '21-4', date: 'Oct 1' }
          ],
          upcomingGames: []
        },
        'diko': {
          name: 'Diko & Co.',
          seed: 15,
          icon: 'üéØ',
          record: { wins: 1, losses: 2 },
          pointDiff: 5,
          roster: [],
          completedGames: [
            { opponent: 'Nav/Sandeep', result: 'L', score: '18-22', date: 'Sep 22' },
            { opponent: 'Tech Support', result: 'L', score: '19-21', date: 'Sep 29' },
            { opponent: 'Kareem Puffs', result: 'W', score: '11-0', date: 'Oct 2' }
          ],
          upcomingGames: []
        },
        'fuse': {
          name: 'Fuse',
          seed: 16,
          icon: '‚ö°',
          record: { wins: 1, losses: 2 },
          pointDiff: 2,
          roster: [],
          completedGames: [
            { opponent: 'Hoop', result: 'L', score: '15-21', date: 'Sep 25' },
            { opponent: 'LeMickey', result: 'L', score: '13-21', date: 'Sep 30' },
            { opponent: 'Squirt Sisters', result: 'W', score: '22-6', date: 'Oct 2' }
          ],
          upcomingGames: []
        }
      };

      try {
        let successCount = 0;
        for (const [teamId, teamData] of Object.entries(teamsData)) {
          const { doc, setDoc } = window.firestoreImports;
          await setDoc(doc(db, 'teams', teamId), teamData);
          log(`‚úì Added team: ${teamData.name}`, 'success');
          successCount++;
        }
        log(`‚úÖ Successfully initialized ${successCount} teams!`, 'success');
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
      } finally {
        btn.disabled = false;
      }
    };

    window.initializeBracket = async function() {
      const btn = document.getElementById('initBracketBtn');
      btn.disabled = true;
      log('Starting bracket initialization...', 'info');

      // Initialize with all TBD slots
      const bracketData = {};

      // Round of 16 slots
      for (let match = 1; match <= 8; match++) {
        bracketData[`r16-${match}-1`] = 'TBD';
        bracketData[`r16-${match}-2`] = 'TBD';
      }

      // Quarterfinals
      for (let i = 1; i <= 8; i++) {
        bracketData[`qf-${i}`] = 'TBD';
      }

      // Semifinals
      for (let i = 1; i <= 4; i++) {
        bracketData[`sf-${i}`] = 'TBD';
      }

      // Finals
      bracketData['f-1'] = 'TBD';
      bracketData['f-2'] = 'TBD';

      // Champion
      bracketData['champion'] = 'TBD';

      try {
        const { doc, setDoc } = window.firestoreImports;
        await setDoc(doc(db, 'tournament', 'bracket'), bracketData);
        log('‚úÖ Successfully initialized bracket with all TBD slots!', 'success');
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
      } finally {
        btn.disabled = false;
      }
    };

    window.initializeAdminPassword = async function() {
      const btn = document.getElementById('initPasswordBtn');
      btn.disabled = true;

      const password = prompt('Enter the admin password you want to set:');

      if (!password) {
        log('‚ö†Ô∏è Password setup cancelled', 'warning');
        btn.disabled = false;
        return;
      }

      if (password.length < 6) {
        log('‚ùå Password must be at least 6 characters long', 'error');
        btn.disabled = false;
        return;
      }

      log('Setting admin password...', 'info');

      try {
        const { doc, setDoc } = window.firestoreImports;
        await setDoc(doc(db, 'system', 'adminConfig'), {
          password: password,
          lastUpdated: new Date().toISOString()
        });
        log('‚úÖ Admin password set successfully!', 'success');
        log(`‚ö†Ô∏è IMPORTANT: Remember your password: ${password}`, 'warning');
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
      } finally {
        btn.disabled = false;
      }
    };

    window.initializeInitPassword = async function() {
      const btn = document.getElementById('initInitPasswordBtn');
      btn.disabled = true;

      const password = prompt('Enter the init-firestore.html password you want to set:');

      if (!password) {
        log('‚ö†Ô∏è Init password setup cancelled', 'warning');
        btn.disabled = false;
        return;
      }

      if (password.length < 6) {
        log('‚ùå Password must be at least 6 characters long', 'error');
        btn.disabled = false;
        return;
      }

      log('Setting init password...', 'info');

      try {
        const { doc, setDoc } = window.firestoreImports;
        await setDoc(doc(db, 'system', 'initConfig'), {
          password: password,
          lastUpdated: new Date().toISOString()
        });
        log('‚úÖ Init password set successfully!', 'success');
        log(`‚ö†Ô∏è IMPORTANT: Remember your init password: ${password}`, 'warning');
      } catch (error) {
        log(`‚ùå Error: ${error.message}`, 'error');
      } finally {
        btn.disabled = false;
      }
    };

    window.initializeAll = async function() {
      log('=== Starting full initialization ===', 'warning');
      await window.initializeTeams();
      await window.initializeBracket();
      await window.initializeAdminPassword();
      log('=== Initialization complete! ===', 'success');
    };

    log('üî• Firestore initialized and ready!', 'success');
  </script>
</body>
</html>
